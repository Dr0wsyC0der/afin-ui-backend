# Диагностика проблемы входа

## Шаг 1: Проверьте, что backend запущен

Откройте в браузере: http://localhost:8000/health

Должно вернуться: `{"status":"ok","service":"gateway"}`

Если не работает:
```powershell
cd afin-backend\services\gateway
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

## Шаг 2: Проверьте подключение через тестовую страницу

Откройте файл `afin-frontend/frontend/check_backend.html` в браузере и:
1. Нажмите "Проверить /health" - должно показать успех
2. Нажмите "Создать пользователя" - создайте тестового пользователя
3. Нажмите "Проверить /api/auth/login" - проверьте вход

## Шаг 3: Проверьте через Swagger UI

Откройте: http://localhost:8000/docs

1. Найдите `/api/auth/register`
2. Создайте пользователя:
   ```json
   {
     "email": "admin@afin.ru",
     "password": "password123",
     "firstName": "Admin",
     "lastName": "User"
   }
   ```
3. Найдите `/api/auth/login`
4. Войдите с теми же данными

## Шаг 4: Проверьте консоль браузера

Откройте DevTools (F12) → Console и посмотрите на ошибки при попытке входа.

Возможные ошибки:
- `Network Error` - backend не запущен или недоступен
- `401 Unauthorized` - неверный email/пароль или пользователь не существует
- `404 Not Found` - неправильный URL API

## Шаг 5: Проверьте настройки frontend

Убедитесь, что:
1. Frontend запущен: `cd afin-frontend/frontend && npm run dev`
2. Vite proxy настроен правильно (см. `vite.config.ts`)
3. В консоли браузера нет ошибок CORS

## Шаг 6: Создайте пользователя вручную

Если ничего не помогает, создайте пользователя через Python:

```powershell
cd afin-backend
python -c "
from services.auth.crud import create_user
from shared.database import SessionLocal
db = SessionLocal()
try:
    user = create_user(db, 'admin@afin.ru', 'password123', 'Admin', 'User')
    print(f'User created: {user.email}')
except Exception as e:
    print(f'Error: {e}')
finally:
    db.close()
"
```

## Частые проблемы

### "Invalid credentials"
- Пользователь не существует → создайте через регистрацию
- Неверный пароль → проверьте пароль

### "Network Error" или "Failed to fetch"
- Backend не запущен → запустите backend
- Неправильный URL → проверьте `VITE_API_BASE_URL` или proxy в vite.config.ts
- CORS ошибка → проверьте настройки CORS в gateway/main.py

### "Cannot read property 'data' of undefined"
- Ошибка в обработке ответа → уже исправлено в коде

## Быстрое решение

1. **Запустите backend:**
   ```powershell
   cd afin-backend\services\gateway
   uvicorn main:app --host 0.0.0.0 --port 8000 --reload
   ```

2. **Откройте http://localhost:8000/docs**

3. **Создайте пользователя через `/api/auth/register`**

4. **Войдите через frontend с теми же данными**


